#include <iostream>
#include <locale>
#include <codecvt>
#include "modAlphaCipher.h"

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –ª–æ–∫–∞–ª–∏
void setRussianLocale() {
    try {
        std::locale::global(std::locale("ru_RU.UTF-8"));
        std::wcout.imbue(std::locale());
        std::wcin.imbue(std::locale());
        std::wcerr.imbue(std::locale());
    } catch (const std::exception& e) {
        std::wcout << L"–ù–µ —É–¥–∞–ª–æ—Å—å —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ª–æ–∫–∞–ª—å ru_RU.UTF-8. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ª–æ–∫–∞–ª—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é." << std::endl;
    }
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –º–µ–Ω—é
void showMenu() {
    std::wcout << L"\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê" << std::endl;
    std::wcout << L"         –®–ò–§–† –ì–†–û–ù–°–§–ï–õ–¨–î–ê - –ú–ï–ù–Æ" << std::endl;
    std::wcout << L"‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê" << std::endl;
    std::wcout << L"1 - –ó–∞—à–∏—Ñ—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç" << std::endl;
    std::wcout << L"2 - –†–∞—Å—à–∏—Ñ—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç" << std::endl;
    std::wcout << L"3 - –ü–æ–∫–∞–∑–∞—Ç—å –ø—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã" << std::endl;
    std::wcout << L"4 - –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —à–∏—Ñ—Ä–µ" << std::endl;
    std::wcout << L"0 - –í—ã—Ö–æ–¥" << std::endl;
    std::wcout << L"‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê" << std::endl;
    std::wcout << L"–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ: ";
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è —Ç–µ–∫—Å—Ç–∞
void encryptText() {
    std::wstring key, text;
    
    std::wcout << L"\n‚îÄ‚îÄ –ó–ê–®–ò–§–†–û–í–ê–ù–ò–ï –¢–ï–ö–°–¢–ê ‚îÄ‚îÄ" << std::endl;
    std::wcout << L"–í–≤–µ–¥–∏—Ç–µ –∫–ª—é—á (—Ä—É—Å—Å–∫–∏–µ –±—É–∫–≤—ã): ";
    std::wcin.ignore();
    std::getline(std::wcin, key);
    
    try {
        modAlphaCipher cipher(key);
        
        std::wcout << L"–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –¥–ª—è —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è: ";
        std::getline(std::wcin, text);
        
        std::wstring encrypted = cipher.encrypt(text);
        
        std::wcout << L"\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê" << std::endl;
        std::wcout << L"–†–ï–ó–£–õ–¨–¢–ê–¢ –®–ò–§–†–û–í–ê–ù–ò–Ø:" << std::endl;
        std::wcout << L"–ö–ª—é—á: " << key << std::endl;
        std::wcout << L"–ò—Å—Ö–æ–¥–Ω—ã–π —Ç–µ–∫—Å—Ç: " << text << std::endl;
        std::wcout << L"–ó–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç: " << encrypted << std::endl;
        std::wcout << L"‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê" << std::endl;
        
    } catch (const cipher_error& e) {
        std::wcout << L"‚ùå –û–®–ò–ë–ö–ê: " << e.what() << std::endl;
    }
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è —Ç–µ–∫—Å—Ç–∞
void decryptText() {
    std::wstring key, text;
    
    std::wcout << L"\n‚îÄ‚îÄ –†–ê–°–®–ò–§–†–û–í–ê–ù–ò–ï –¢–ï–ö–°–¢–ê ‚îÄ‚îÄ" << std::endl;
    std::wcout << L"–í–≤–µ–¥–∏—Ç–µ –∫–ª—é—á (—Ä—É—Å—Å–∫–∏–µ –±—É–∫–≤—ã): ";
    std::wcin.ignore();
    std::getline(std::wcin, key);
    
    try {
        modAlphaCipher cipher(key);
        
        std::wcout << L"–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –¥–ª—è —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è: ";
        std::getline(std::wcin, text);
        
        std::wstring decrypted = cipher.decrypt(text);
        
        std::wcout << L"\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê" << std::endl;
        std::wcout << L"–†–ï–ó–£–õ–¨–¢–ê–¢ –†–ê–°–®–ò–§–†–û–í–ê–ù–ò–Ø:" << std::endl;
        std::wcout << L"–ö–ª—é—á: " << key << std::endl;
        std::wcout << L"–ó–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç: " << text << std::endl;
        std::wcout << L"–†–∞—Å—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç: " << decrypted << std::endl;
        std::wcout << L"‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê" << std::endl;
        
    } catch (const cipher_error& e) {
        std::wcout << L"‚ùå –û–®–ò–ë–ö–ê: " << e.what() << std::endl;
    }
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ –ø—Ä–∏–º–µ—Ä–æ–≤
void showExamples() {
    std::wcout << L"\n‚îÄ‚îÄ –ü–†–ò–ú–ï–†–´ –†–ê–ë–û–¢–´ –®–ò–§–†–ê ‚îÄ‚îÄ" << std::endl;
    
    // –ü—Ä–∏–º–µ—Ä 1
    try {
        modAlphaCipher cipher1(L"–ö–õ–Æ–ß");
        std::wstring encrypted1 = cipher1.encrypt(L"–ü–†–ò–í–ï–¢–ú–ò–†");
        std::wstring decrypted1 = cipher1.decrypt(encrypted1);
        
        std::wcout << L"\n–ü—Ä–∏–º–µ—Ä 1:" << std::endl;
        std::wcout << L"–ö–ª—é—á: –ö–õ–Æ–ß" << std::endl;
        std::wcout << L"–¢–µ–∫—Å—Ç: –ü–†–ò–í–ï–¢–ú–ò–†" << std::endl;
        std::wcout << L"–ó–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–æ: " << encrypted1 << std::endl;
        std::wcout << L"–†–∞—Å—à–∏—Ñ—Ä–æ–≤–∞–Ω–æ: " << decrypted1 << std::endl;
        std::wcout << L"‚úì –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å: " << (L"–ü–†–ò–í–ï–¢–ú–ò–†" == decrypted1 ? L"–î–ê" : L"–ù–ï–¢") << std::endl;
    } catch (const cipher_error& e) {
        std::wcout << L"–û—à–∏–±–∫–∞ –≤ –ø—Ä–∏–º–µ—Ä–µ 1: " << e.what() << std::endl;
    }
    
    // –ü—Ä–∏–º–µ—Ä 2
    try {
        modAlphaCipher cipher2(L"–°–ï–ö–†–ï–¢");
        std::wstring encrypted2 = cipher2.encrypt(L"–ü–†–û–ì–†–ê–ú–ú–ò–†–û–í–ê–ù–ò–ï");
        std::wstring decrypted2 = cipher2.decrypt(encrypted2);
        
        std::wcout << L"\n–ü—Ä–∏–º–µ—Ä 2:" << std::endl;
        std::wcout << L"–ö–ª—é—á: –°–ï–ö–†–ï–¢" << std::endl;
        std::wcout << L"–¢–µ–∫—Å—Ç: –ü–†–û–ì–†–ê–ú–ú–ò–†–û–í–ê–ù–ò–ï" << std::endl;
        std::wcout << L"–ó–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–æ: " << encrypted2 << std::endl;
        std::wcout << L"–†–∞—Å—à–∏—Ñ—Ä–æ–≤–∞–Ω–æ: " << decrypted2 << std::endl;
        std::wcout << L"‚úì –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å: " << (L"–ü–†–û–ì–†–ê–ú–ú–ò–†–û–í–ê–ù–ò–ï" == decrypted2 ? L"–î–ê" : L"–ù–ï–¢") << std::endl;
    } catch (const cipher_error& e) {
        std::wcout << L"–û—à–∏–±–∫–∞ –≤ –ø—Ä–∏–º–µ—Ä–µ 2: " << e.what() << std::endl;
    }
    
    // –ü—Ä–∏–º–µ—Ä 3 —Å —Ä–∞–∑–Ω—ã–º–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞–º–∏
    try {
        modAlphaCipher cipher3(L"–ø–∞—Ä–æ–ª—å");
        std::wstring encrypted3 = cipher3.encrypt(L"–ü—Ä–∏–≤–µ—Ç –ú–∏—Ä!");
        std::wstring decrypted3 = cipher3.decrypt(encrypted3);
        
        std::wcout << L"\n–ü—Ä–∏–º–µ—Ä 3 (—Ä–∞–∑–Ω—ã–µ —Ä–µ–≥–∏—Å—Ç—Ä—ã):" << std::endl;
        std::wcout << L"–ö–ª—é—á: –ø–∞—Ä–æ–ª—å" << std::endl;
        std::wcout << L"–¢–µ–∫—Å—Ç: –ü—Ä–∏–≤–µ—Ç –ú–∏—Ä!" << std::endl;
        std::wcout << L"–ó–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–æ: " << encrypted3 << std::endl;
        std::wcout << L"–†–∞—Å—à–∏—Ñ—Ä–æ–≤–∞–Ω–æ: " << decrypted3 << std::endl;
        std::wcout << L"‚úì –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å: " << (L"–ü–†–ò–í–ï–¢–ú–ò–†" == decrypted3 ? L"–î–ê" : L"–ù–ï–¢") << std::endl;
    } catch (const cipher_error& e) {
        std::wcout << L"–û—à–∏–±–∫–∞ –≤ –ø—Ä–∏–º–µ—Ä–µ 3: " << e.what() << std::endl;
    }
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —à–∏—Ñ—Ä–µ
void showInfo() {
    std::wcout << L"\n‚îÄ‚îÄ –ò–ù–§–û–†–ú–ê–¶–ò–Ø –û –®–ò–§–†–ï –ì–†–û–ù–°–§–ï–õ–¨–î–ê ‚îÄ‚îÄ" << std::endl;
    std::wcout << L"–®–∏—Ñ—Ä –ì—Ä–æ–Ω—Å—Ñ–µ–ª—å–¥–∞ - —ç—Ç–æ –ø–æ–ª–∏–∞–ª—Ñ–∞–≤–∏—Ç–Ω—ã–π —à–∏—Ñ—Ä –ø–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∏," << std::endl;
    std::wcout << L"—É–ø—Ä–æ—â–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è —à–∏—Ñ—Ä–∞ –í–∏–∂–µ–Ω–µ—Ä–∞." << std::endl;
    std::wcout << L"\n–ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã:" << std::endl;
    std::wcout << L"‚Ä¢ –ö–∞–∂–¥–æ–π –±—É–∫–≤–µ –∞–ª—Ñ–∞–≤–∏—Ç–∞ —Å–æ–ø–æ—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è —á–∏—Å–ª–æ (–ê=0, –ë=1, ..., –Ø=32)" << std::endl;
    std::wcout << L"‚Ä¢ –ë—É–∫–≤—ã —Ç–µ–∫—Å—Ç–∞ —Å–∫–ª–∞–¥—ã–≤–∞—é—Ç—Å—è —Å –±—É–∫–≤–∞–º–∏ –∫–ª—é—á–∞ –ø–æ –º–æ–¥—É–ª—é 33" << std::endl;
    std::wcout << L"‚Ä¢ –ö–ª—é—á –ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏ –¥–æ –¥–ª–∏–Ω—ã —Ç–µ–∫—Å—Ç–∞" << std::endl;
    std::wcout << L"\n–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:" << std::endl;
    std::wcout << L"‚Ä¢ –†–∞–±–æ—Ç–∞–µ—Ç —Å —Ä—É—Å—Å–∫–∏–º –∞–ª—Ñ–∞–≤–∏—Ç–æ–º (33 –±—É–∫–≤—ã –≤–∫–ª—é—á–∞—è –Å)" << std::endl;
    std::wcout << L"‚Ä¢ –†–µ–≥–∏—Å—Ç—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏–≤–æ–¥–∏—Ç—Å—è –∫ –≤–µ—Ä—Ö–Ω–µ–º—É" << std::endl;
    std::wcout << L"‚Ä¢ –ù–µ-–±—É–∫–≤–µ–Ω–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã –∏–≥–Ω–æ—Ä–∏—Ä—É—é—Ç—Å—è" << std::endl;
    std::wcout << L"‚Ä¢ –ö–ª—é—á –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ç–æ–ª—å–∫–æ —Ä—É—Å—Å–∫–∏–µ –±—É–∫–≤—ã" << std::endl;
}

int main() {
    setRussianLocale();
    
    std::wcout << L"‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà" << std::endl;
    std::wcout << L"‚ñà                                            ‚ñà" << std::endl;
    std::wcout << L"‚ñà        –®–ò–§–†–û–í–ê–õ–¨–©–ò–ö –ì–†–û–ù–°–§–ï–õ–¨–î–ê           ‚ñà" << std::endl;
    std::wcout << L"‚ñà         –¥–ª—è —Ä—É—Å—Å–∫–æ–≥–æ —è–∑—ã–∫–∞                ‚ñà" << std::endl;
    std::wcout << L"‚ñà                                            ‚ñà" << std::endl;
    std::wcout << L"‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà" << std::endl;
    
    int choice;
    do {
        showMenu();
        std::wcin >> choice;
        
        switch (choice) {
            case 1:
                encryptText();
                break;
            case 2:
                decryptText();
                break;
            case 3:
                showExamples();
                break;
            case 4:
                showInfo();
                break;
            case 0:
                std::wcout << L"\n–î–æ —Å–≤–∏–¥–∞–Ω–∏—è! üëã" << std::endl;
                break;
            default:
                std::wcout << L"‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –≤—ã–±–æ—Ä! –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞." << std::endl;
        }
        
        if (choice != 0) {
            std::wcout << L"\n–ù–∞–∂–º–∏—Ç–µ Enter –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è...";
            std::wcin.ignore();
            std::wcin.get();
        }
        
    } while (choice != 0);
    
    return 0;
}
